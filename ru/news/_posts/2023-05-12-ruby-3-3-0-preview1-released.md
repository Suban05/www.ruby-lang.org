---
layout: news_post
title: "Выпуск Ruby 3.3.0-preview1"
author: "naruse"
translator: "suban05"
date: 2023-05-12 00:00:00 +0000
lang: ru
---

{% assign release = site.data.releases | where: "version", "3.3.0-preview1" | first %}

Мы рады объявить о выпуске Ruby {{ release.version }}. Ruby 3.3 добавляет новый чистый JIT-компилятор на Ruby под названием RJIT, использует Lrama в качестве генератора парсеров и внес множество улучшений производительности, особенно YJIT.

## RJIT

* Введен чисто-рубиновый JIT-компилятор на Ruby RJIT, заменивший MJIT.
  * RJIT поддерживает только архитектуру x86\_64 на платформах Unix.
  * В отличие от MJIT, он не требует компилятора на C во время выполнения.
* RJIT предназначен исключительно для экспериментальных целей.
  * В продакшене следует продолжать использовать YJIT.
* Если вас интересует разработка JIT для Ruby, обратитесь к [презентации k0kubun на третий день RubyKaigi](https://rubykaigi.org/2023/presentations/k0kubun.html#day3).

## Использование Lrama вместо Bison

* Замена Bison на [генератор парсеров Lrama LALR](https://github.com/yui-knk/lrama) [Feature #19637](https://bugs.ruby-lang.org/issues/19637)
  * Если вас это интересует, ознакомьтесь с [Будущим видением парсера Ruby](https://rubykaigi.org/2023/presentations/spikeolaf.html)

## YJIT

* Значительные улучшения производительности по сравнению с 3.2
  * Улучшена поддержка расширяемых списков и аргументов rest.
  * Регистры выделяются для операций стека виртуальной машины.
  * Компилируются больше вызовов с опциональными аргументами.
  * `Integer#!=`, `String#!=`, `Kernel#block_given?`, `Kernel#is_a?`, `Kernel#instance_of?`, `Module#===` особенно оптимизированы.
  * Переменные экземпляра больше не возвращаются в интерпретатор с мегаморфными формами объектов.
* Метаданные для скомпилированного кода используют гораздо меньше памяти.
* Улучшена генерация кода на ARM64.
* Добавлена опция запуска YJIT в режиме паузы, с возможностью позже вручную его включить
  * `--yjit-pause` и `RubyVM::YJIT.resume`
  * Это можно использовать, чтобы включить YJIT только после завершения загрузки вашего приложения.
* Опция трассировки выхода теперь поддерживает выборочное отслеживание
  * `--trace-exits-sample-rate=N`
* Множество исправлений ошибок



## Другие заметные новые функции

### Язык



## Улучшения производительности

* `defined?(@ivar)` оптимизирован с использованием форм объектов.

## Другие значимые изменения с момента 3.2



## Проблемы совместимости

Примечание: Исключая исправления ошибок функций.

### Удаленные константы

Следующие устаревшие константы удалены.



### Удаленные методы

Следующие устаревшие методы удалены.



## Проблемы совместимости со стандартной библиотекой

### `ext/readline` устарел

* У нас есть `reline`, которая является реализацией на чистом Ruby, совместимой с API `ext/readline`. В будущем мы будем полагаться на `reline`. Если вам нужно использовать `ext/readline`, вы можете установить `ext/readline` через rubygems.org с помощью `gem install readline-ext`.
* Нам больше не нужно устанавливать библиотеки типа `libreadline` или `libedit`.

## Обновления C API

### Обновленные C API

Следующие API были обновлены.



### Удаленные C API

Следующие устаревшие API были удалены.



## Обновления стандартной библиотеки

Следующие стандартные гемы были обновлены.

* RubyGems 3.5.0.dev
* bigdecimal 3.1.4
* bundler 2.5.0.dev
* csv 3.2.7
* fiddle 1.1.2
* fileutils 1.7.1
* irb 1.6.4
* optparse 0.4.0.pre.1
* psych 5.1.0
* reline 0.3.3
* stringio 3.0.7
* strscan 3.0.7
* syntax_suggest 1.0.4
* time 0.2.2
* timeout 0.3.2
* uri 0.12.1

Следующие пакетные гемы были обновлены.

* minitest 5.18.0
* rbs 3.1.0
* typeprof 0.21.7
* debug 1.8.0

Для получения дополнительной информации о стандартных и пакетных гемах обратитесь к GitHub-релизам, таким как [Logger](https://github.com/ruby/logger/releases) или к изменениям в журнале изменений.

Подробности о новостях смотрите в [NEWS](https://github.com/ruby/ruby/blob/{{ release.tag }}/NEWS.md)
или [логах коммитов](https://github.com/ruby/ruby/compare/v3_2_0...{{ release.tag }})
для получения дополнительной информации.

С учетом этих изменений, [{{ release.stats.files_changed }} файлов изменено, {{ release.stats.insertions }} добавлено(+), {{ release.stats.deletions }} удалено(-)](https://github.com/ruby/ruby/compare/v3_2_0...{{ release.tag }}#file_bucket)
с момента Ruby 3.2.0!

## Скачать

* <{{ release.url.gz }}>

      SIZE: {{ release.size.gz }}
      SHA1: {{ release.sha1.gz }}
      SHA256: {{ release.sha256.gz }}
      SHA512: {{ release.sha512.gz }}

* <{{ release.url.xz }}>

      SIZE: {{ release.size.xz }}
      SHA1: {{ release.sha1.xz }}
      SHA256: {{ release.sha256.xz }}
      SHA512: {{ release.sha512.xz }}

* <{{ release.url.zip }}>

      SIZE: {{ release.size.zip }}
      SHA1: {{ release.sha1.zip }}
      SHA256: {{ release.sha256.zip }}
      SHA512: {{ release.sha512.zip }}

## Что такое Ruby

Ruby был разработан Мацем (Юкихиро Мацумото) в 1993 году и сейчас развивается как открытое программное обеспечение. Он работает на множестве платформ и широко используется по всему миру, особенно в веб-разработке.
